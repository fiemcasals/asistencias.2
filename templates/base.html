{% load static %}
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Asistencias Diplomaturas{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'core/styles.css' %}?v={% now 'U' %}">
</head>

<body>
  <header class="topbar">
    <div class="container">
      <-H <a class="brand" href="{% url 'asistencias:home' %}">Asistencias</a> -->

      <nav class="navbar">
        <div class="nav-left">
          <a href="{% url 'asistencias:home' %}">Inicio</a>

          {% if request.user.is_authenticated %}
          <-H <a href="{% url 'asistencias:publico' %}">Dar Presente</a> -->
          <a href="{% url 'asistencias:consulta_publica' %}">Consultar</a>
          {% if request.user.nivel != 7 %}
          {% if request.user.nivel == 6 %}
          <a href="{% url 'asistencias:insc_diplomatura_codigo' %}">Inscribirse a diplomatura</a>
          {% else %}
          <a href="{% url 'asistencias:insc_materia_codigo' %}">Inscribirse a materia</a>
          {% endif %}
          {% endif %}
          <a href="{% url 'asistencias:usar_token' %}">Canjear Token</a>


          {% if request.user.nivel == 3 or request.user.nivel == 5 %}
          <a href="{% url 'asistencias:exportar_xlsx' %}">Exportar datos</a>
          <a href="{% url 'asistencias:listar_diplomaturas' %}">Diplomaturas</a>
          <a href="{% url 'asistencias:generar_constancia' %}">Constancia Alumno</a>
          {% endif %}
          {% else %}
          <a href="{% url 'account_login' %}">Ingresar</a>
          <a href="{% url 'account_signup' %}">Registrarse</a>
          {% endif %}
        </div>

        {% if request.user.is_authenticated %}
        <div class="nav-right" style="display: flex; align-items: center; gap: 15px;">
          {% if request.user.nivel == 7 or request.session.impersonate_role %}
          <div class="dropdown" style="position: relative; display: inline-block;">
            <button class="btn-icon" onclick="toggleDropdown()"
              style="background:none; border:none; color:white; font-size: 1.2rem; cursor: pointer;">
              üëÅÔ∏è
            </button>
            <div id="roleDropdown" class="dropdown-content"
              style="display: none; position: absolute; right: 0; background-color: #333; min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1000;">
              <a href="{% url 'asistencias:switch_role' 1 %}" style="color: white; padding: 12px 16px; text-decoration: none; display: block;">Alumno {% if request.user.nivel == 1 %}‚úì{% endif %}</a>
              <a href="{% url 'asistencias:switch_role' 2 %}" style="color: white; padding: 12px 16px; text-decoration: none; display: block;">Docente {% if request.user.nivel == 2 %}‚úì{% endif %}</a>
              <a href="{% url 'asistencias:switch_role' 3 %}" style="color: white; padding: 12px 16px; text-decoration: none; display: block;">Coordinador {% if request.user.nivel == 3 %}‚úì{% endif %}</a>
              <a href="{% url 'asistencias:switch_role' 6 %}" style="color: white; padding: 12px 16px; text-decoration: none; display: block;">Referente Mun. {% if request.user.nivel == 6 %}‚úì{% endif %}</a>
              <a href="{% url 'asistencias:switch_role' 7 %}" style="color: white; padding: 12px 16px; text-decoration: none; display: block;">Supervisor {% if request.user.nivel == 7 %}‚úì{% endif %}</a>
            </div>
          </div>
          <script>
            function toggleDropdown() {
              var d = document.getElementById("roleDropdown");
              if (d.style.display === "block") {
                d.style.display = "none";
              } else {
                d.style.display = "block";
              }
            }
            // Close if clicked outside
            window.onclick = function (event) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                for (var i = 0; i < dropdowns.length; i++) {
                  var openDropdown = dropdowns[i];
                  if (openDropdown.style.display === "block") {
                    openDropdown.style.display = "none";
                  }
                }
              }
            }
          </script>
          <style>
            .dropdown-content a:hover {
              background-color: #555;
            }
          </style>
          {% endif %}
          <a href="{% url 'account_logout' %}" class="btn-logout">Salir</a>
        </div>
        {% endif %}
      </nav>
    </div>
  </header>

  <main class="container">
    {% for message in messages %}
    <div class="alert">{{ message }}</div>
    {% endfor %}
    {% block content %}{% endblock %}
  </main>

  <footer class="footer">
    <div class="container">¬© 2025</div>
  </footer>
</body>

</html>