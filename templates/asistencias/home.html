{% extends 'base.html' %}
{% block title %}Inicio{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
  <h1>Inicio</h1>
  {% if request.user.nivel >= 3 %}
  <a class="btn" href="{% url 'asistencias:crear_materia' %}">+ Nueva Materia</a>
  {% endif %}
</div>

{% if request.user.is_authenticated %}
<div class="card">
  <h2>Calendario de Clases</h2>
  <div id="calendar"></div>
</div>

<!-- FullCalendar -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'es',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      events: [
        {% for e in eventos %}
        {
        title: "{{ e.title }}",
        start: "{{ e.start }}",
        url: "{% if e.can_edit %}{% url 'asistencias:editar_clase' e.id %}{% else %}#{% endif %}",
        color: "{{ e.color }}",
        extendedProps: {
          materia_id: "{{ e.materia_id }}",
          can_edit: {% if e.can_edit %}true{% else %}false{% endif %}
          }
        },
    {% endfor %}
      ],
    eventClick: function (info) {
      if (info.event.extendedProps.can_edit) {
        // Allow default behavior (navigate to URL)
      } else {
        info.jsEvent.preventDefault(); // Don't navigate if student
      }
    }
    });
  calendar.render();
  });
</script>
<style>
  #calendar {
    max-width: 100%;
    margin: 0 auto;
    font-family: var(--font-family);
  }

  .fc-event {
    cursor: pointer;
  }
</style>
{% endif %}

<h2>Diplomaturas</h2>

<div class="grid">
  {% for d in diplomaturas %}
  <div class="card">
    <h3>{{ d.nombre }}</h3>
    <p class="muted">Código: {{ d.codigo }}</p>

    <ul>
      {% for m in d.materias.all %}
      <li>
        {{ m.nombre }} — <a href="{% url 'asistencias:ver_clases' m.id %}">ver clases</a>
      </li>
      {% endfor %}
    </ul>
  </div>
  {% empty %}
  <p>No tenés diplomaturas asignadas.</p>
  {% endfor %}
</div>

{% endblock %}