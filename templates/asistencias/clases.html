{% extends 'base.html' %}
{% block title %}Clases{% endblock %}
{% block content %}
<h1>{{ materia.diplomatura.nombre }} Â· {{ materia.nombre }}</h1>

{% if request.user.nivel|default:1 >= 2 or can_manage %}
<div class="actions">
  {% if can_manage %}
  <a class="btn" href="{% url 'asistencias:crear_clase' materia.id %}">+ Crear clase</a>
  <a class="btn" href="{% url 'asistencias:listado_presentes' materia.id %}">Ver presentes/ausentes</a>
  <a class="btn" href="{% url 'asistencias:token_adjunto' materia.id %}">Generar token adjunto</a>
  {% endif %}

  {% if can_manage %}
  <a class="btn" href="{% url 'asistencias:cargar_notas' materia.id %}">Cargar Notas</a>
  <a class="btn" href="{% url 'asistencias:promedios_materia' materia.id %}">Promedios</a>
  <a class="btn" href="{% url 'asistencias:exportar_asistencia_materia' materia.id %}">Exportar Asistencia</a>
  {% endif %}
</div>
{% endif %}

{% if request.user.nivel == 1 %}
<div class="actions">
  <a class="btn" href="{% url 'asistencias:mis_notas' %}">Mis Notas</a>
</div>
{% endif %}

{% for c in clases %}
<div class="card">
  <h3>{{ c.fecha }} â€” {{ c.hora_inicio }}â€“{{ c.hora_fin }}</h3>
  {% if c.link_clase %}
  <p style="margin-top: 5px; font-size: 0.9em;">
    ðŸ”— <a href="{{ c.link_clase }}" target="_blank" rel="noopener noreferrer">{{ c.link_clase|truncatechars:50 }}</a>
  </p>
  {% endif %}
  {% if c.ventana_activa %}
  <a class="btn" href="{% url 'asistencias:marcar_presente' c.id %}">Dar presente</a>
  {% else %}
  <span class="badge">Fuera de horario</span>
  {% endif %}
</div>
{% empty %}
<p><em>Sin clases.</em></p>
{% endfor %}
{% if request.user.is_authenticated %}
{% if not es_docente %}
<form method="post" action="{% url 'asistencias:desinscribirse_materia' materia.id %}" style="display:inline"
  onsubmit="return confirm('Â¿Seguro que querÃ©s desinscribirte?');">
  {% csrf_token %}
  <button class="btn danger" type="submit">Desinscribirme</button>
</form>
{% endif %}
{% endif %}

{% endblock %}